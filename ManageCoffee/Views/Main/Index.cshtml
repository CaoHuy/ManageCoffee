@{
    ViewData["Title"] = "Đặt món";
}
<script src="https://cdn.jsdelivr.net/npm/@@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/@@splidejs/splide@4.1.4/dist/css/splide.min.css" rel="stylesheet">

<div id="main-content p-1 vh-100" class="main-order">
    <div class="container-fluid overflow-hidden ">
        <div class="row mb-4 pt-1 overflow-auto justify-content-between">
            <div class="col-11 d-flex justify-content-start">
                @* <button class="btn btn-primary me-3 btn-table-delivery">Bán mang đi</button> *@
                <div class="btn-group d-flex justify-content-center align-items-center" id="search-table">
                    <input type="radio" name="status" value="all" id="table-status-all" class="btn-check" checked>
                    <label class="btn btn-outline-primary table-status" for="table-status-all">Tất cả</label>
                    <input type="radio" name="status" value="0" id="table-status-0" class="btn-check">
                    <label class="btn btn-outline-primary table-status" for="table-status-0">Đang trống</label>
                    <input type="radio" name="status" value="1" id="table-status-1" class="btn-check">
                    <label class="btn btn-outline-primary table-status" for="table-status-1">Có khách</label>
                </div>
            </div>
            <div class="col-1 d-flex justify-content-end">
                <div id="cart" class="cart p-0 z-5">
                    <button type="button" class="btn-show-offcanvas btn btn-primary position-relative">
                        <i class="bi bi-cart4 h2"></i>
                        <span
                            class="position-absolute number-details start-0 translate-middle badge rounded-pill bg-danger d-none"
                            style="top: 16% !important">
                        </span>
                    </button>
                </div>
                <div id="bell" class="bell p-0 z-5 ms-2">
                    <button type="button" class="btn btn-primary dropdown-toggle position-relative"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-bell h2"></i>
                        <span
                            class="position-absolute number-meals start-0 translate-middle badge rounded-pill bg-danger d-none"
                            style="top: 16% !important">
                        </span>
                        <ul class="dropdown-menu dropdown-list">
                        </ul>
                    </button>
                </div>

            </div>
            <div class="col-11 d-flex justify-content-start mt-3">
                <div class="btn-group d-flex justify-content-center align-items-center" id="sreach-area">
                    <input type="radio" name="search-option" value="area-all" id="area-status-all" class="btn-check me-2" checked>
                    <label class="btn btn-outline-primary table-status" for="area-status-all">Tất cả khu vực</label>
                    @foreach (var area in ViewBag.Areas)
                    {
                                <input type="radio" name="search-option" value="@area.AreaId" id="area-status-@area.AreaId" class="btn-check me-2">
                                <label class="btn btn-outline-primary table-status" for="area-status-@area.AreaId">@area.Name</label>
                    }
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <section class="splide" aria-labelledby="carousel-heading">
                        <div class="splide__track">
                            <ul id="table-list" class="splide__list">
                            </ul>
                        </div>
                    </section>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-12 d-flex justify-content-start" style="min-width: 75rem">
                    <div class="btn-group" id="search-product">
                        <input type="radio" name="catalogue" value="all" id="product-catalogue-all" class="btn-check"
                            checked>
                        <label class="btn btn-outline-primary" for="product-catalogue-all">Tất cả</label>
                        @foreach (var catalogue in ViewBag.Catalogues)
                        {
                                    <input type="radio" name="catalogue" value="@catalogue.CatalogueId"
                                        id="product-catalogue-@catalogue.CatalogueId" class="btn-check">
                                    <label class="btn btn-outline-primary"
                                        for="product-catalogue-@catalogue.CatalogueId">@catalogue.Name</label>
                        }
                    </div>
                </div>
            </div>
            <div id="product-list" class="row justify-content-start align-items-center mb-3">
            </div>
        </div>

        <div class="offcanvas-end">
            <div class="offcanvas offcanvas-end" tabindex="-1" data-bs-scroll="true" data-bs-backdrop="false"
                id="bill-canvas" aria-labelledby="bill-canvas-label">
                <div class="row offcanvas-header justify-content-start">
                    <div class="col-10">
                        <h3 class="offcanvas-title" id="bill-canvas-label">Chi tiết hóa đơn</h3>
                    </div>
                    <div class="col-2 text-end">
                        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                </div>
                <div class="row justify-content-start">
                    <span class="table-selected"></span>
                </div>
                <div class="offcanvas-body pt-0">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <p class="fs-4 text-secondary d-inline mb-1 align-middle bill-tables"></p>
                        <p class="fs-4 text-secondary d-inline mb-1 align-middle"><span
                                class="badge bg-light-primary text-primary border border-primary bill-created_at"></span>
                        </p>
                    </div>
                    <div class="row bill-controls">
                        <div class="col-6 d-flex align-items-center">
                            <small class="text-secondary bill-meta" style="line-height: 1.2rem"></small>
                            <div
                                class="border border-2 rounded-3 bg-outline-primary p-2 fw-bold d-flex justify-content-center align-items-center table-name">
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="row justify-content-end">
                                <div class="col-4 px-0">
                                    <button class="btn btn-outline-primary btn-print" data-bs-toggle="tooltip"
                                        data-bs-title="In">
                                        <i class="bi bi-printer"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr class="px-4">
                    <form action="/Main/Create" method="post" id="main-form" class="save-form" accept-charset="UTF-8">
                        <ul class="bill-details">
                        </ul>
                        <hr class="px-4">
                        <div class="d-flex justify-content-between text-dark mt-2">
                            <p class="fw-bold mb-1">Tổng đơn:</p>
                            <p class="bill-total mb-1">0</p>
                            <input type="hidden" name="total_price" class="input-bill-total" value="0">
                        </div>
                        <input type="hidden" name="table_id">
                        <div class="bill-footer d-grid gap-4">
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-success btn-bill">
                                    <h5 class="fw-bold pt-1"><i class="bi bi-receipt"></i>
                                        Lên đơn
                                    </h5>
                                </button>
                                <input type="hidden" name="id">
                                <button type="button" class="btn btn-success btn-pay d-none">
                                    <h5 class="fw-bold pt-1"><i class="bi bi-coin"></i>
                                        Thanh toán
                                    </h5>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
    <div class="extra-interface d-none">
    <div class="row text-center justify-content-center">
        <div class="col-lg-4 col-12">
            <svg xmlns="http://www.w3.org/2000/svg" width="260" height="293" viewBox="0 0 586.47858 659.29778"
                xmlns:xlink="http://www.w3.org/1999/xlink">
                <circle cx="332.47856" cy="254" r="254.00001" fill="#f2f2f2" />
                <path
                    d="M498.46363,113.58835H33.17063c-.99774-.02133-1.78931-.84746-1.76797-1.84521,.02069-.96771,.80026-1.74727,1.76797-1.76796H498.46363c.99774,.02133,1.78931,.84746,1.76794,1.84521-.02069,.96771-.80023,1.74727-1.76794,1.76796Z"
                    fill="#cacaca" />
                <rect x="193.77441" y="174.47256" width="163.61147" height="34.98639" rx="17.49318" ry="17.49318"
                    fill="#fff" />
                <path
                    d="M128.17493,244.44534H422.98542c9.66122,0,17.49316,7.83197,17.49316,17.49319h0c0,9.66122-7.83194,17.49319-17.49316,17.49319H128.17493c-9.66122,0-17.49318-7.83197-17.49318-17.49319h0c0-9.66122,7.83196-17.49319,17.49318-17.49319Z"
                    fill="#fff" />
                <path
                    d="M128.17493,314.41812H422.98542c9.66122,0,17.49316,7.83197,17.49316,17.49319h0c0,9.66122-7.83194,17.49319-17.49316,17.49319H128.17493c-9.66122,0-17.49318-7.83197-17.49318-17.49319h0c0-9.66122,7.83196-17.49319,17.49318-17.49319Z"
                    fill="#fff" />
                <path
                    d="M91.64085,657.75932l-.69385-.06793c-23.54068-2.42871-44.82135-15.08929-58.18845-34.61835-3.66138-5.44159-6.62299-11.32251-8.815-17.50409l-.21069-.58966,.62375-.05048c7.44699-.59924,15.09732-1.86292,18.49585-2.46417l-21.91473-7.42511-.1355-.65033c-1.29926-6.10406,1.24612-12.38458,6.4285-15.86176,5.19641-3.64447,12.08731-3.76111,17.40405-.29449,2.38599,1.52399,4.88162,3.03339,7.29489,4.49359,8.29321,5.01636,16.8688,10.20337,23.29828,17.30121,9.74951,10.97778,14.02298,25.76984,11.63,40.25562l4.7829,17.47595Z"
                    fill="#f2f2f2" />
                <polygon
                    points="171.30016 646.86102 182.10017 646.85999 187.23916 605.198 171.29716 605.19897 171.30016 646.86102"
                    fill="#a0616a" />
                <path
                    d="M170.9192,658.12816l33.21436-.00122v-.41998c-.00049-7.13965-5.78833-12.92737-12.92798-12.92773h-.00079l-6.06702-4.60278-11.3197,4.60345-2.89941,.00012,.00055,13.34814Z"
                    fill="#2f2e41" />
                <polygon
                    points="84.74116 616.94501 93.38016 623.42603 122.49316 593.185 109.74116 583.61902 84.74116 616.94501"
                    fill="#a0616a" />
                <path
                    d="M77.67448,625.72966l26.569,19.93188,.25208-.336c4.2843-5.71136,3.12799-13.81433-2.58279-18.09937l-.00064-.00049-2.09079-7.32275-11.81735-3.11102-2.31931-1.73993-8.01019,10.67767Z"
                    fill="#2f2e41" />
                <path
                    d="M120.64463,451.35271s.59625,16.26422,1.3483,29.30737c.12335,2.13916-4.88821,4.46301-4.75842,6.7901,.08609,1.54395,1.02808,3.04486,1.1156,4.65472,.09235,1.69897-1.20822,3.20282-1.1156,4.95984,.09052,1.71667,1.57422,3.6853,1.66373,5.44244,.96317,18.9093,4.45459,41.54633,.9584,47.87439-1.72299,3.11871-23.68533,46.32446-23.68533,46.32446,0,0,12.23666,18.35498,15.73285,12.23663,4.61771-8.08099,40.20615-45.88745,40.20615-53.10712,0-7.21088,8.23346-61.25323,8.23346-61.25323l5.74103,31.98169,2.63239,6.33655-.82715,3.71997,1.70117,5.02045,.09192,4.96838,1.65619,9.22614s-4.98199,71.88159-2.17633,73.88312c2.81439,2.01038,16.44086,5.62018,18.04901,2.01038,1.59955-3.6098,12.0108-75.01947,12.0108-75.01947,0,0,1.6781-32.72424,3.49622-63.14111,.1048-1.76556,1.34607-3.89825,1.4422-5.63763,.11365-2.01898-.67297-4.64111-.56818-6.599,.11365-2.24628,1.11005-3.82831,1.20618-5.97852,.74292-16.6156-3.42761-36.84912-4.7561-38.84192-4.01202-6.01343-7.62177-10.82074-7.62177-10.82074,0,0-54.03558-17.75403-68.47485,.28625l-3.30185,25.37585Z"
                    fill="#2f2e41" />
                <path
                    d="M174.53779,284.10378l-21.4209-4.28418-9.9964,13.56656h0c-18.65262,18.34058-18.93359,34.52753-15.60379,60.47382v36.41553l-2.41,24.41187s-8.53156,17.84521,.26788,22.00006,66.59857,3.80066,72.117,2.14209,.73517-3.69482-.71399-11.4245c-2.72211-14.51929-.90131-7.51562-.71399-12.13849,2.68585-66.31363-3.57013-93.5379-4.20544-100.69376l-10.89398-19.75858-6.42639-10.71042Z"
                    fill="#3f3d56" />
                <path
                    d="M287.43909,337.57097c-2.23248,4.23007-7.47144,5.84943-11.70148,3.61694-.45099-.23804-.88013-.51541-1.28229-.82895l-46.26044,29.37308,.13336-15.9924,44.93842-26.07846c3.20093-3.58887,8.70514-3.90332,12.29401-.70239,3.00305,2.67844,3.7796,7.0657,1.87842,10.61218Z"
                    fill="#a0616a" />
                <path
                    d="M157.62488,302.62425l-5.26666-.55807c-4.86633-.50473-9.64093,1.57941-12.57947,5.491-1.12549,1.48346-1.9339,3.18253-2.37491,4.99164l-.00317,.01447c-1.32108,5.44534,.75095,11.15201,5.25803,14.48117l18.19031,13.41101c12.76544,17.24899,36.75653,28.69272,64.89832,37.98978l43.74274-27.16666-15.47186-18.73843-30.00336,16.0798-44.59833-34.52374-.0257-.02075-16.97424-10.936-4.79169-.5152Z"
                    fill="#3f3d56" />
                <circle cx="167.29993" cy="248.60526" r="24.9798" fill="#a0616a" />
                <path
                    d="M167.8769,273.59047c-.20135,.00662-.4032,.01108-.6048,.01657-.0863,.22388-.17938,.44583-.2868,.66357l.8916-.68015Z"
                    fill="#2f2e41" />
                <path
                    d="M174.73243,249.29823c.03918,.24612,.09912,.48846,.17914,.72449-.03302-.24731-.09308-.49026-.17914-.72449Z"
                    fill="#2f2e41" />
                <path
                    d="M192.59852,224.6942c-1.0282,3.19272-1.94586-.85715-5.32825-.12869-4.06885,.87625-8.80377,.57532-12.13586-1.91879-4.96478-3.64273-11.39874-4.62335-17.22333-2.62509-5.70154,2.01706-15.25348,3.43933-16.73907,9.30179-.51642,2.03781-.7215,4.24933-1.97321,5.9382-1.09436,1.47662-2.82166,2.31854-4.26608,3.45499-4.87726,3.83743-1.14954,14.73981,1.15881,20.50046,2.30838,5.76065,7.60355,9.95721,13.42526,12.10678,5.63281,2.07977,11.7464,2.44662,17.75531,2.28317,1.04517-2.7106,.59363-5.84137-.26874-8.65134-.93359-3.04199-2.31592-5.97791-2.70593-9.13599s.46643-6.74527,3.11444-8.50986c2.4339-1.62192,6.39465-.63388,7.32062,1.98843-.54028-3.27841,2.7807-6.4509,6.20508-7.00882,3.67651-.599,7.35291,.72833,11.01886,1.38901s2.36475-14.77301,.64209-18.98425Z"
                    fill="#2f2e41" />
                <circle cx="281.3585" cy="285.71051" r="51.12006"
                    transform="translate(-26.58509 542.54478) rotate(-85.26884)" fill="var(--primary)" />
                <path
                    d="M294.78675,264.41051l-13.42828,13.42828-13.42828-13.42828c-2.17371-2.17374-5.69806-2.17374-7.87177,0s-2.17371,5.69803,0,7.87177l13.42828,13.42828-13.42828,13.42828c-2.17169,2.17575-2.1684,5.70007,.00739,7.87177,2.17285,2.16879,5.69153,2.16879,7.86438-.00003l13.42828-13.42828,13.42828,13.42828c2.17578,2.17169,5.70007,2.1684,7.87177-.00735,2.16882-2.17288,2.16882-5.6915,0-7.86438l-13.42828-13.42828,13.42828-13.42828c2.17371-2.17374,2.17371-5.69803,0-7.87177s-5.69806-2.17374-7.87177,0h0Z"
                    fill="#fff" />
                <path
                    d="M261.21387,242.74385c1.5069,4.53946-.95154,9.44101-5.49097,10.94791-.48401,.16064-.9812,.27823-1.4859,.35141l-10.83051,53.71692-11.44788-11.16785,12.29266-50.48209c-.37366-4.7944,3.21008-8.98395,8.00452-9.3576,4.01166-.31265,7.71509,2.16425,8.95807,5.9913Z"
                    fill="#a0616a" />
                <path
                    d="M146.12519,312.22478l-4.04883,3.41412c-3.73322,3.16214-5.53476,8.05035-4.74649,12.87888,.29129,1.83917,.95773,3.59879,1.95786,5.16949l.00824,.0123c3.01477,4.72311,8.5672,7.17865,14.08978,6.23117l22.27075-3.84171c21.28461,2.72995,46.15155-6.65967,72.34302-20.53055l10.67969-50.37274-24.23297-1.80811-9.16821,32.78271-55.78815,8.28149-.03278,.00415-19.64294,4.67767-3.68896,3.1011Z"
                    fill="#3f3d56" />
                <path
                    d="M272.93684,658.99046l-271.75,.30731c-.65759-.00214-1.18896-.53693-1.18683-1.19452,.00211-.6546,.53223-1.18469,1.18683-1.18683l271.75-.30731c.65759,.00214,1.18896,.53693,1.18683,1.19452-.00208,.6546-.53223,1.18469-1.18683,1.18683Z"
                    fill="#cacaca" />
                <g>
                    <ellipse cx="56.77685" cy="82.05834" rx="8.45661" ry="8.64507" fill="#3f3d56" />
                    <ellipse cx="85.9906" cy="82.05834" rx="8.45661" ry="8.64507" fill="#3f3d56" />
                    <ellipse cx="115.20435" cy="82.05834" rx="8.45661" ry="8.64507" fill="#3f3d56" />
                    <path
                        d="M148.51577,88.89113c-.25977,0-.51904-.10059-.71484-.30078l-5.70605-5.83301c-.38037-.38867-.38037-1.00977,0-1.39844l5.70605-5.83252c.38721-.39453,1.021-.40088,1.41406-.01562,.39502,.38623,.40186,1.01953,.01562,1.41406l-5.02197,5.1333,5.02197,5.13379c.38623,.39453,.37939,1.02783-.01562,1.41406-.19434,.19043-.44678,.28516-.69922,.28516Z"
                        fill="#3f3d56" />
                    <path
                        d="M158.10415,88.89113c-.25244,0-.50488-.09473-.69922-.28516-.39502-.38623-.40186-1.01904-.01562-1.41406l5.02148-5.13379-5.02148-5.1333c-.38623-.39453-.37939-1.02783,.01562-1.41406,.39404-.38672,1.02783-.37939,1.41406,.01562l5.70557,5.83252c.38037,.38867,.38037,1.00977,0,1.39844l-5.70557,5.83301c-.1958,.2002-.45508,.30078-.71484,.30078Z"
                        fill="#3f3d56" />
                    <path
                        d="M456.61398,74.41416h-10.60999c-1.21002,0-2.19,.97998-2.19,2.19v10.62c0,1.21002,.97998,2.19,2.19,2.19h10.60999c1.21002,0,2.20001-.97998,2.20001-2.19v-10.62c0-1.21002-.98999-2.19-2.20001-2.19Z"
                        fill="#3f3d56" />
                    <path
                        d="M430.61398,74.41416h-10.60999c-1.21002,0-2.19,.97998-2.19,2.19v10.62c0,1.21002,.97998,2.19,2.19,2.19h10.60999c1.21002,0,2.20001-.97998,2.20001-2.19v-10.62c0-1.21002-.98999-2.19-2.20001-2.19Z"
                        fill="#3f3d56" />
                    <path
                        d="M481.11398,74.91416h-10.60999c-1.21002,0-2.19,.97998-2.19,2.19v10.62c0,1.21002,.97998,2.19,2.19,2.19h10.60999c1.21002,0,2.20001-.97998,2.20001-2.19v-10.62c0-1.21002-.98999-2.19-2.20001-2.19Z"
                        fill="#3f3d56" />
                    <path
                        d="M321.19229,78.95414h-84.81c-1.48004,0-2.67004,1.20001-2.67004,2.67004s1.19,2.66998,2.67004,2.66998h84.81c1.46997,0,2.66998-1.20001,2.66998-2.66998s-1.20001-2.67004-2.66998-2.67004Z"
                        fill="var(--primary)" />
                </g>
            </svg>
            <h5 class="my-3">Bạn chưa được cấp quyền truy cập vào đây!</h5>
        </div>
    </div>
</div>



    @section Scripts {
            <script>
                    function slider_config() {
                        var splide = new Splide('.splide', {
                            drag: true,
                            arrows: false,
                            pagination: false,
                            perPage: 6,
                            breakpoints: {
                                600: {
                                    perPage: 2
                                }
                            },
                            height: 'auto'
                        });
                        splide.mount();
                    }

                    localStorage.setItem('a', [])
                    $(document).ready(function () {
                        $.get('/User/GetUserInfo', function (data) {
                            switch (data.role) {
                                case 1:
                                    break;
                                case 3:
                                    break;
                                default:
                                    $('.main-order').empty();
                                    $('.extra-interface').removeClass('d-none');
                                    break;
                            }
                        })
                        loadDropdown()
                        $('#sidebar').removeClass('active')
                        loadTable('all', 'area-all');
                        loadProduct('all');

                    function loadTable(selectedStatus, selectedAreaId) {
                        let str_table = '';
                        $.get('/Main/Load', function (data) {
                            $.each(data.tables, function (index, table) {
                                if ((selectedStatus == 'all' || selectedStatus == table.status) &&
                                    (selectedAreaId == 'area-all' || selectedAreaId == table.areaId)) {
                                    let table_statusStr = '';
                                    if (table.status == 0) {
                                        table_statusStr = '<span class="text-success">Đang trống</span>';
                                    } else if (table.status == 1) {
                                        table_statusStr = '<span class="text-danger">Có khách</span>';
                                    }
                                    // Gọi hàm GetAreaName để lấy tên khu vực dựa vào areaId
                                    $.get(`/Main/GetAreaName?areaId=${table.areaId}`, function (response) {
                                        let areaName = response.areaName;
                                        str_table += `
                                            <li class="splide__slide pt-3">
                                                <label for="table-${table.tableId}" class="cursor-pointer table-label">
                                                    <div class="card table-card div-hover-effect shadow-sm p-3 text-center rounded-4 rounded-lg-5"
                                                        style="width: 12rem;">
                                                        <span class="text-overlay">${areaName}</span>
                                                        <div class="card-body pt-0">
                                                            <h4 class="card-title text-uppercase text-primary">${table.name}</h4>
                                                            <small>${table_statusStr}</small>
                                                        </div>
                                                    </div>
                                                <input type="radio" name="table" id="table-${table.tableId}" value="${table.tableId}" data-status="${table.status}" class="d-none table-select" />
                                                </label>
                                            </li>`;
                                        $('#table-list').html(str_table);
                                        slider_config();
                                    });
                                }
                            });
                        });
                    }


                    function loadProduct(valueToChange) {
                        let str_product = '';
                        $.get('/Main/Load', function (data) {
                         
                         
                            let productsExist = false;
                            $.each(data.products, function (index, product) {
                                if (valueToChange === 'all' || product.catalogueId == valueToChange) {
                                    let pro_catalogue = ``;
                                    // Gửi yêu cầu AJAX để lấy tên danh mục
                                    $.get(`/Main/GetCatalogueName?catalogueId=${product.catalogueId}`, function (response) {
                                        let catalogueName = response.catalogueName;
                                        str_product += `
                                            <div class="col-6 col-md-3 col-lg-2 product-col">
                                                <div class="card product-card bg-transparent cursor-pointer" data-id="${product.productId}">
                                                    <div class="ratio ratio-16x9 mb-2 div-hover-effect">
                                                        <img src="${product.image}" onerror="this.onerror=null; this.src='/img/placeholder.jpg'" class="card-img-top rounded-4 rounded-lg-5 object-fit-cover" alt="${product.name}">
                                                    </div>
                                                    <div class="row px-3 justify-content-start align-items-center">
                                                        <div class="col-12 p-0">
                                                            <p class="text-primary card-title mb-0 fw-bold">${product.name}</p>
                                                        </div>
                                                        <div class="col-8">
                                                            <ul class="card-text ps-0 d-flex text-secondary" style="list-style-type: none;">
                                                                <li><small><i class="bi bi-bookmarks-fill"></i>${catalogueName}</small></li>
                                                            </ul>
                                                        </div>
                                                        <div class="col-2 p-0">
                                                            <div class="ratio ratio-1x1 text-center mt-1">
                                                                <span class="text-primary border-primary rounded-3 bg-light-primary align-middle fw-bold fs-5 pt-2">${number_format(product.price / 1000)}</span>
                                                            </div>
                                                        </div>
                                                        <div class="col-2 dropstart btn-group product-menu" data-id="${product.productId}">
                                                            <button class="btn btn-link mb-0 px-2 py-1" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                <i class="bi bi-three-dots-vertical"></i>
                                                            </button>
                                                            <ul class="dropdown-menu p-2">
                                                                <li>
                                                                    <a class="cursor-pointer dropdown-item btn-update-product" data-id="${product.productId}">
                                                                        <small><i class="bi bi-pencil-square"></i> Sửa món</small>
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <hr>
                                                                </li>
                                                                <li>
                                                                    <form action="/Product/Delete" method="post" class="save-form">
                                                                        <input type="hidden" name="choices[]" value="${product.productId}">
                                                                        <button type="submit" class="cursor-pointer text-danger dropdown-item btn-remove">
                                                                            <small><i class="bi bi-trash3"></i> Xóa món</small>
                                                                        </button>
                                                                    </form>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>`;
                                        productsExist = true;
                                        $('#product-list').html(str_product);
                                    });
                                } else {
                                    str_product = '';
                                    $('#product-list').html(str_product);
                                }
                            });
                        });
                    }



                    $(document).on('click', '.btn-show-offcanvas', function (e) {
                        $('#bill-canvas').offcanvas('show');
                    })

                    $(document).on('click', '.btn-table-delivery', function (e) {
                        e.preventDefault();
                        $('.bill-details').empty();
                        $('.bill-total').text(0);
                        var id = $(this).find('[name=table]').val();
                        $.each($('.table-label'), function (index, entity) {
                            $(this).removeClass('table-selected');
                            $(entity).find('.card.table-card').removeClass('border border-primary border-3')
                        });
                        $(this).addClass('table-selected');
                        $('.table-name').text("Mang đi");
                        $('#bill-canvas').offcanvas('show');
                    });

                    $(document).on('click', '.btn-bill', function (e) {
                        e.preventDefault();
                        if ($('.bill-details').find('*').length > 0) {
                            $.ajax({
                                type: $('#main-form').attr('method'),
                                url: $('#main-form').attr('action'),
                                data: $('#main-form').serialize(),
                                dataType: 'json',
                                success: function (response) {
                                    Toastify({
                                        text: response.msg,
                                        duration: 3000,
                                        close: true,
                                        gravity: "top",
                                        position: "center",
                                        backgroundColor: `var(--bs-${response.status})`,
                                    }).showToast();
                                    setTimeout(function () {
                                        ordered("Da len don");
                                        window.location.href = "/Main/Index";
                                    }, 2000);
                                },
                                error: function (xhr, status, error) {
                                    console.error(error);
                                }    
                            });
                        } else {
                            Swal.fire({
                                title: "Lưu ý!",
                                text: "Vui lòng chọn món!",
                                icon: "warning",
                                showConfirmButton: true,
                                confirmButtonText: "OK, Đã hiểu!",
                            })
                        }
                    });

                    $(document).on('click', '.table-label', function (e) {
                        e.preventDefault();
                        $('.number-details').text(0).removeClass('d-none');
                        const form = $('#main-form')
                        form.find('[name=id]').val(null)
                        form.attr('action', '/Main/Create')
                        if (!$(this).hasClass('table-selected')) {
                            $('.bill-details').empty();
                            $('.bill-total').text(0);
                        }
                        var id = $(this).find('[name=table]').val();
                        $('#main-form').find('input[name="table_id"]').val(id);
                        $.each($('.table-label'), function (index, entity) {
                            $(this).removeClass('table-selected');
                            $(entity).find('.card.table-card').removeClass('border border-primary border-3')
                        });
                        $(this).addClass('table-selected');
                        $(this).find('.card.table-card').addClass('border border-primary border-3');
                        $('.table-name').addClass('d-none');
                        $('#bill-canvas').offcanvas('show');
                        $.get(`/Main/GetOrderByTableId/?id=${id}`, function (data) {
                            $('.table-name').text(data.table.name).removeClass('d-none').addClass('border border-2');
                            $('.btn-print').attr('data-id', data.order.orderId)
                            form.find('.btn-pay').attr('data-id', data.order.orderId).removeClass('d-none');
                            form.find('[name=id]').val(data.order.orderId)
                            form.find('.bill-total').text(number_format(data.order.totalPrice));
                            form.find('.input-bill-total').val(data.order.totalPrice);
                    
                            if (data.order.orderId != null) {
                                form.attr('action', '/Main/Edit')
                            }
                            $('.bill-details').empty();
                            $.each(data.details, function (index, detail) {
                                $.get('/Product/getProduct/?id=' + detail.productId, function (response) {
                                
                                    const str = `<div class="text-dark d-flex flex-column align-items-between w-100 ms-1 mt-2 bill-detail" data-id=${response.productId}>
                                                    <div class="text-start px-1 fw-bold">${response.product.name}</div>
                                                    <div class="row">
                                                        <div class="col-4 text-end pe-5 d-flex align-items-center"><span class="me-2 d-flex align-items-center">${number_format(response.product.price)}</span></div>
                                                        <input type="hidden" name="id[]" value="${response.product.productId}"/>
                                                        <input type="hidden" name="price[]" class="text-center px-1 bill-price border border-0" value="${response.product.price}">
                                                        <input type="number" name="quantity[]" class="col-2 text-center px-1 bill-quantity border border-0" value="${detail.quantity}">
                                                        <div class="col-4 text-end px-1 d-flex justify-content-end"><span class="bill-total-price me-2 d-flex align-items-center">${number_format(response.product.price * detail.quantity)}</span></div>
                                                        <div class="col-1">
                                                            <button type="button" class="btn btn-outline-secondary border border-0 btn-cancel rounded-2">&times;</button>
                                                        </div>
                                                    </div>`
                                    $('.bill-details').append(str);
                                    var quantity = 0;
                                    $('.bill-quantity').each(function () {
                                        quantity += parseInt($(this).val());
                                    })
                                    $('.number-details').text(quantity);
                                });
                            });
                        })
                    });

            @* $(document).on('change', '#search-table', function () {
                loadTable($(this).find('[name=status]:checked').val());
            }); *@

                    $(document).on('change', '#search-table', function () {
                        var selectedStatus = $('[name=status]:checked').val(); // Lấy trạng thái bàn được chọn
                        var selectedAreaId = $('[name=search-option]:checked').val(); // Lấy khu vực được chọn
                        // Thực hiện việc lọc và hiển thị danh sách các bàn tương ứng
                        loadTable(selectedStatus, selectedAreaId);
                    });

                    $(document).on('change', '#sreach-area', function () {
                        var selectedAreaId = $(this).find('[name=search-option]:checked').val();
                        var selectedStatus = $('#search-table').find('[name=status]:checked').val();
                        loadTable(selectedStatus, selectedAreaId);
                    });


                    $(document).on('change', '#search-product', function () {
                        loadProduct($(this).find('[name=catalogue]:checked').val());
                    });

                    $(document).on('click', '.btn-print', function () {
                        const id = parseInt($(this).attr('data-id'));
                        window.open(
                            `Order/Bill?order_id=${id}`,
                            '_blank',
                            'toolbar=no,scrollbars=no,menubar=no,status=no,resizable=no,top=150,left=600,width=500,height=650'
                        );
                    })

                    $(document).on('change keyup', '.bill-quantity', function () {
                        var quantity = 0;
                        $('.bill-quantity').each(function () {
                            quantity += parseInt($(this).val());
                        })
                        $('.number-details').text(quantity).removeClass('d-none');
                        var inputValue = $(this).val();
                        $(this).val((inputValue >= 1) ? inputValue : 1)
                        calcBillMain()
                        $('#main-form').find('.btn-pay').addClass('d-none');
                    })

                    $(document).on('click', '.product-card', function () {
                        var quantity = 0;
                        const id = parseInt($(this).attr('data-id'));
                        $('#main-form').find('.btn-pay').addClass('d-none');
                        $.get('/Product/GetProduct/?id=' + id, function (response) {
                            console.log(response.product)
                            const str = `<div class="text-dark d-flex flex-column align-items-between w-100 ms-1 mt-2 bill-detail" data-id=${response.product.productId}>
                                                <div class="text-start px-1 fw-bold">${response.product.name}</div>
                                                <div class="row">
                                                    <div class="col-4 text-end pe-5  d-flex align-items-center"><span class="me-2 d-flex align-items-center">${number_format(response.product.price)}</span></div>
                                                    <input type="hidden" name="id[]" value="${response.product.productId}"/>
                                                    <input type="hidden" name="price[]" class="text-center px-1 bill-price border border-0" value="${response.product.price}">
                                                    <input type="number" name="quantity[]" class="col-2 text-center px-1 bill-quantity border border-0" value="1">
                                                    <div class="col-4 text-end px-1 d-flex justify-content-end"><span class="bill-total-price me-2 d-flex align-items-center">${number_format(response.product.price)}</span></div>
                                                    <div class="col-1">
                                                        <button type="button" class="btn btn-outline-secondary border border-0 btn-cancel rounded-2">&times;</button>
                                                    </div>
                                            </div>`
                            $('.bill-details').append(str);
                            calcBillMain()
                            $('.bill-quantity').each(function () {
                                quantity += parseInt($(this).val());
                            })
                            $('.number-details').text(quantity).removeClass('d-none');
                        });
                    })

                    $(document).on('click', '.btn-cancel', function () {
                        $(this).parents('.bill-detail').remove();
                        $('#main-form').find('.btn-pay').addClass('d-none')
                        var quantity = 0;
                        $('.bill-quantity').each(function () {
                            quantity += parseInt($(this).val());
                        })
                        $('.number-details').text(quantity).removeClass('d-none');
                        calcBillMain();
                    })

                    $(document).on('click', '.btn-pay', function () {
                        const id = parseInt($(this).attr('data-id'));
                        const priceIMG = $(this).parents('form').find('.input-bill-total').val();
                        Swal.fire({
                            title: "Thanh toán",
                            text: "Vui lòng chọn phương thức thanh toán",
                            icon: "warning",
                            showCancelButton: true,
                            confirmButtonText: "Tiền mặt",
                            cancelButtonText: "Chuyển khoản",
                            reverseButtons: true
                        }).then((result) => {
                            let totalPrice_img = 0;
                            if (!result.isConfirmed) {
                                let modalEx = $('#config-example'), str = `https://img.vietqr.io/image/`;
                                $.get(`/Config/Load`, function (configList) {
                                    $.each(configList, function (index, config) {
                                        if (config.key == "bank_number") {
                                            str += config.value + '-';
                                        } if (config.key == "bank_id") {
                                            str += config.value + '-';
                                        }
                                        if (config.key == "bank_template") {
                                            str += config.value + `.png?amount=${priceIMG}&addInfo=`;
                                        }
                                        if (config.key == "bank_content") {
                                            str += config.value;
                                        }
                                    });
                                    modalEx.find('img').attr('src', str);
                                });
                                modalEx.modal('show');
            @* console.log(str); *@
                                    modalEx.on('hidden.bs.modal', function (e) {
                                        $.ajax({
                                            url: '/Order/Pay',
                                            type: 'POST',
                                            data: { id: id, payment: '2' },
                                            success: function () {
                                                window.location.href = "/Main/Index";
                                            },
                                            error: function (xhr, status, error) {
                                                console.error(xhr.responseText);
                                            }
                                        });
                                    });
                            } else {
                                $.ajax({
                                    url: '/Order/Pay',
                                    type: 'POST',
                                    data: { id: id, payment: '1' },
                                    success: function () {
                                        window.location.href = "/Main/Index";
                                    },
                                    error: function (xhr, status, error) {
                                        console.error(xhr.responseText);
                                    }
                                });
                            }
                        });
                        });

                        $('.number-meals').text(JSON.parse(localStorage.getItem('localDetails')).length).removeClass('d-none');

                        $(document).on('click', '.btn-remove-bartender', function (e) {
                            e.preventDefault()
                            var localDetails = JSON.parse(localStorage.getItem('localDetails')), newlocalDetails = [];
                            let detail_id = $(this).attr('data-id');
                            $.each(localDetails, function (i, detail_product_name) {
                                if (detail_product_name.detail.detailId != detail_id) {
                                    newlocalDetails.push({ detail: detail_product_name.detail, productName: detail_product_name.productName })
                                }
                            })
                            localStorage.setItem('localDetails', JSON.stringify(newlocalDetails))
                            window.location.href = "/Main/Index";
                    })

                });

                    function calcBillMain() {
                        let total = 0;
                        $('#main-form .bill-detail').each(function () {
                            let sum = $(this).find('.bill-price').val() * $(this).find('.bill-quantity').val();
                            $(this).find('.bill-total-price').text(number_format(sum));
                            total += sum;
                        })
                        $('#main-form').find('.input-bill-total').val(total)
                        $('#main-form').find('.bill-total').text(number_format(total))
                    }

                    function loadDropdown() {
                        var localDetails = JSON.parse(localStorage.getItem('localDetails'));
                        let str = ``
                        $.each(localDetails, function (i, detail_product_name) {
                            str += `<li><a class="dropdown-item btn-remove-bartender" href="#" data-id=${detail_product_name.detail.detailId}>${detail_product_name.productName}</a></li>`
                        })
                        $('.dropdown-list').append(str)
                    }

                    var connection = new signalR.HubConnectionBuilder().withUrl("/chatHub").build();
                    connection.on("Noti", function (detail) {
                        var localDetails = localStorage.getItem('localDetails');
                        if (!localDetails || localDetails.length === 0) {
                            localDetails = [];
                        } else {
                            localDetails = JSON.parse(localDetails);
                        }
                        localDetails.push(detail);
                        localStorage.setItem('localDetails', JSON.stringify(localDetails))
                        $('.number-meals').text(localDetails.length).removeClass('d-none');
                        window.location.href = "/Main/Index";
                    });



                    connection.start().then(function () {
                        log("Kếconsole.t nối SignalR đã được thiết lập.");
                    }).catch(function (err) {
                        console.error("Lỗi khi kết nối SignalR: " + err);
                    });

                    function ordered(data) {
                        connection.invoke("Ordered", data).catch(function (err) {
                            console.error("Lỗi khi gọi hàm SendNotification: " + err.toString());
                        });
                    }
                </script>
    }